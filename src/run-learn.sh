#!/bin/bash

# command-line arguments:
# 1: trial id
# 2: run type (1,2,...)
# 3: run id (e.g., run-001)

TRIAL_ID=$1
RUN_TYPE=$2
RUN_ID=$3

# output directory
OUT_DIR="$HOME/projects/dynamic-engrams/simulations/sim_rc_p11/$RUN_ID"

# source directory
SOURCE="src"
DIR=$OUT_DIR/$SOURCE

. $DIR/globalvars.sh

FULL_OUT_DIR=$OUT_DIR/$TRIAL_ID

mpirun -n $NP $DIR/$BIN_FULL --binary $BIN_FULL --out_dir $FULL_OUT_DIR --file_prefix $FILE_PREFIX_LEARN-$SIMTIME_BURN --file_prefix_hm $FILE_PREFIX_LEARN_HM-$SIMTIME_BURN --load_file $FULL_OUT_DIR/$FILE_PREFIX_BURN-$SIMTIME_BURN --simtimes $SIMTIME_LEARN_1 $SIMTIME_LEARN_2 $SIMTIME_LEARN_3 $SIMTIME_LEARN_4 $SIMTIME_LEARN_5 $SIMTIME_LEARN_6 $SIMTIME_LEARN_7 $SIMTIME_LEARN_8 $SIMTIME_LEARN_9 $SIMTIME_LEARN_10 $SIMTIME_LEARN_11 $SIMTIME_LEARN_12 --save --save_without_hpc --exc_spike_mon_thl --inh_spike_mon_thl --exc_spike_mon_ctx --inh_spike_mon_ctx --exc_spike_mon_hpc --inh_spike_mon_hpc --exc_ratechk_thl --exc_ratechk_ctx --exc_ratechk_hpc --stim_seed ${STIM_SEED_LEARN[$TRIAL_ID]} --master_seed ${MASTER_SEED_LEARN[$TRIAL_ID]} --exc_size_thl $EXC_SIZE_THL --eta_thl $ETA_THL --eta_stim_thl $ETA_STIM_THL --eta_exc_inh_thl $ETA_EXC_INH_THL  --exc_inh_thl $EXC_INH_THL --alpha_thl $ALPHA_THL --kappa_thl $KAPPA_THL --tauf_ee_thl $TAUF_EE_THL --taud_ee_thl $TAUD_EE_THL --tauh_ee_thl $TAUH_EE_THL --ujump_ee_thl $UJUMP_EE_THL --tauf_ee_stim_thl $TAUF_EE_STIM_THL --taud_ee_stim_thl $TAUD_EE_STIM_THL --tauh_ee_stim_thl $TAUH_EE_STIM_THL --ujump_ee_stim_thl $UJUMP_EE_STIM_THL --beta_thl $BETA_THL --beta_stim_thl $BETA_STIM_THL --delta_thl $DELTA_THL --weight_a_thl $WEIGHTA_THL --weight_c_thl $WEIGHTC_THL --adapt1_thl $ADAPT1_THL --adapt2_thl $ADAPT2_THL --pot_strength_thl $POT_STRENGTH_THL --wmax_exc_thl $WMAX_EXC_THL --wmin_exc_thl $WMIN_EXC_THL --wmax_inh_thl $WMAX_INH_THL --wmin_inh_thl $WMIN_INH_THL --wee_thl $WEE_THL --wei_thl $WEI_THL --wie_thl $WIE_THL --wii_thl $WII_THL --wext_thl $WEXT_THL --sparseness_int_ee_thl $SPARSENESS_INT_EE_THL --sparseness_int_ei_thl $SPARSENESS_INT_EI_THL --sparseness_int_ii_thl $SPARSENESS_INT_II_THL --sparseness_int_ie_thl $SPARSENESS_INT_IE_THL --sparseness_ext_thl $SPARSENESS_EXT_THL --tauf_ei_thl $TAUF_EI_THL --taud_ei_thl $TAUD_EI_THL --ujump_ei_thl $UJUMP_EI_THL --tauh_ie_thl $TAUH_IE_THL --taud_ei_stim_thl $TAUD_EI_STIM_THL --tauf_ei_stim_thl $TAUF_EI_STIM_THL --ujump_ei_stim_thl $UJUMP_EI_STIM_THL --tau_ampa_e_thl $TAU_AMPA_E_THL --tau_gaba_e_thl $TAU_GABA_E_THL --tau_nmda_e_thl $TAU_NMDA_E_THL --ampa_nmda_e_thl $AMPA_NMDA_E_THL --tau_ampa_i_thl $TAU_AMPA_I_THL --tau_gaba_i_thl $TAU_GABA_I_THL --tau_nmda_i_thl $TAU_NMDA_I_THL --ampa_nmda_i_thl $AMPA_NMDA_I_THL --exc_size_ctx $EXC_SIZE_CTX --eta_ctx $ETA_CTX --eta_stim_ctx $ETA_STIM_CTX --eta_exc_inh_ctx $ETA_EXC_INH_CTX  --exc_inh_ctx $EXC_INH_CTX --alpha_ctx $ALPHA_CTX --kappa_ctx $KAPPA_CTX --tauf_ee_ctx $TAUF_EE_CTX --taud_ee_ctx $TAUD_EE_CTX --tauh_ee_ctx $TAUH_EE_CTX --ujump_ee_ctx $UJUMP_EE_CTX --tauf_ee_stim_ctx $TAUF_EE_STIM_CTX --taud_ee_stim_ctx $TAUD_EE_STIM_CTX --tauh_ee_stim_ctx $TAUH_EE_STIM_CTX --ujump_ee_stim_ctx $UJUMP_EE_STIM_CTX --beta_ctx $BETA_CTX --beta_stim_ctx $BETA_STIM_CTX --delta_ctx $DELTA_CTX --weight_a_ctx $WEIGHTA_CTX --weight_c_ctx $WEIGHTC_CTX --adapt1_ctx $ADAPT1_CTX --adapt2_ctx $ADAPT2_CTX --pot_strength_ctx $POT_STRENGTH_CTX --wmax_exc_ctx $WMAX_EXC_CTX --wmin_exc_ctx $WMIN_EXC_CTX --wmax_inh_ctx $WMAX_INH_CTX --wmin_inh_ctx $WMIN_INH_CTX --wee_ctx $WEE_CTX --wei_ctx $WEI_CTX --wie_ctx $WIE_CTX --wii_ctx $WII_CTX --wext_ctx $WEXT_CTX --sparseness_int_ee_ctx $SPARSENESS_INT_EE_CTX --sparseness_int_ei_ctx $SPARSENESS_INT_EI_CTX --sparseness_int_ii_ctx $SPARSENESS_INT_II_CTX --sparseness_int_ie_ctx $SPARSENESS_INT_IE_CTX --sparseness_ext_ctx $SPARSENESS_EXT_CTX --tauf_ei_ctx $TAUF_EI_CTX --taud_ei_ctx $TAUD_EI_CTX --ujump_ei_ctx $UJUMP_EI_CTX --tauh_ie_ctx $TAUH_IE_CTX --taud_ei_stim_ctx $TAUD_EI_STIM_CTX --tauf_ei_stim_ctx $TAUF_EI_STIM_CTX --ujump_ei_stim_ctx $UJUMP_EI_STIM_CTX --tau_ampa_e_ctx $TAU_AMPA_E_CTX --tau_gaba_e_ctx $TAU_GABA_E_CTX --tau_nmda_e_ctx $TAU_NMDA_E_CTX --ampa_nmda_e_ctx $AMPA_NMDA_E_CTX --tau_ampa_i_ctx $TAU_AMPA_I_CTX --tau_gaba_i_ctx $TAU_GABA_I_CTX --tau_nmda_i_ctx $TAU_NMDA_I_CTX --ampa_nmda_i_ctx $AMPA_NMDA_I_CTX --exc_size_hpc $EXC_SIZE_HPC --eta_hpc $ETA_HPC --eta_stim_hpc $ETA_STIM_HPC --eta_exc_inh_hpc $ETA_EXC_INH_HPC --exc_inh_hpc $EXC_INH_HPC --alpha_hpc $ALPHA_HPC --kappa_hpc $KAPPA_HPC --tauf_ee_hpc $TAUF_EE_HPC --taud_ee_hpc $TAUD_EE_HPC --tauh_ee_hpc $TAUH_EE_HPC --ujump_ee_hpc $UJUMP_EE_HPC --tauf_ee_stim_hpc $TAUF_EE_STIM_HPC --taud_ee_stim_hpc $TAUD_EE_STIM_HPC --tauh_ee_stim_hpc $TAUH_EE_STIM_HPC --ujump_ee_stim_hpc $UJUMP_EE_STIM_HPC --beta_hpc $BETA_HPC --beta_stim_hpc $BETA_STIM_HPC --delta_hpc $DELTA_HPC --weight_a_hpc $WEIGHTA_HPC --weight_c_hpc $WEIGHTC_HPC --adapt1_hpc $ADAPT1_HPC --adapt2_hpc $ADAPT2_HPC --pot_strength_hpc $POT_STRENGTH_HPC --wmax_exc_hpc $WMAX_EXC_HPC --wmin_exc_hpc $WMIN_EXC_HPC --wmax_inh_hpc $WMAX_INH_HPC --wmin_inh_hpc $WMIN_INH_HPC --wee_hpc $WEE_HPC --wei_hpc $WEI_HPC --wie_hpc $WIE_HPC --wii_hpc $WII_HPC --wext_hpc $WEXT_HPC --sparseness_int_ee_hpc $SPARSENESS_INT_EE_HPC --sparseness_int_ei_hpc $SPARSENESS_INT_EI_HPC --sparseness_int_ii_hpc $SPARSENESS_INT_II_HPC --sparseness_int_ie_hpc $SPARSENESS_INT_IE_HPC --sparseness_ext_hpc $SPARSENESS_EXT_HPC --tauf_ei_hpc $TAUF_EI_HPC --taud_ei_hpc $TAUD_EI_HPC --ujump_ei_hpc $UJUMP_EI_HPC --tauh_ie_hpc $TAUH_IE_HPC --taud_ei_stim_hpc $TAUD_EI_STIM_HPC --tauf_ei_stim_hpc $TAUF_EI_STIM_HPC --ujump_ei_stim_hpc $UJUMP_EI_STIM_HPC --tau_ampa_e_hpc $TAU_AMPA_E_HPC --tau_gaba_e_hpc $TAU_GABA_E_HPC --tau_nmda_e_hpc $TAU_NMDA_E_HPC --ampa_nmda_e_hpc $AMPA_NMDA_E_HPC --tau_ampa_i_hpc $TAU_AMPA_I_HPC --tau_gaba_i_hpc $TAU_GABA_I_HPC --tau_nmda_i_hpc $TAU_NMDA_I_HPC --ampa_nmda_i_hpc $AMPA_NMDA_I_HPC --eta_exc_inh2_hpc $ETA_EXC_INH2_HPC --exc_inh2_hpc $EXC_INH2_HPC --alpha2_hpc $ALPHA2_HPC --wmax_inh2_hpc $WMAX_INH2_HPC --wmin_inh2_hpc $WMIN_INH2_HPC --wei2_hpc $WEI2_HPC --wi2e_hpc $WI2E_HPC --wi2i2_hpc $WI2I2_HPC --wii2_hpc $WII2_HPC --wi2i_hpc $WI2I_HPC --sparseness_int_ei2_hpc $SPARSENESS_INT_EI2_HPC --sparseness_int_i2e_hpc $SPARSENESS_INT_I2E_HPC --sparseness_int_i2i2_hpc $SPARSENESS_INT_I2I2_HPC --sparseness_int_ii2_hpc $SPARSENESS_INT_II2_HPC  --sparseness_int_i2i_hpc $SPARSENESS_INT_I2I_HPC --tauf_ei2_hpc $TAUF_EI2_HPC --taud_ei2_hpc $TAUD_EI2_HPC --ujump_ei2_hpc $UJUMP_EI2_HPC --tauh_i2e_hpc $TAUH_I2E_HPC --tau_ampa_i2_hpc $TAU_AMPA_I2_HPC --tau_gaba_i2_hpc $TAU_GABA_I2_HPC --tau_nmda_i2_hpc $TAU_NMDA_I2_HPC --ampa_nmda_i2_hpc $AMPA_NMDA_I2_HPC --wee_thl_ctx $WEE_THL_CTX --sparseness_thl_ctx $SPARSENESS_THL_CTX --eta_thl_ctx $ETA_THL_CTX --kappa_thl_ctx $KAPPA_THL_CTX --tauf_thl_ctx $TAUF_THL_CTX --taud_thl_ctx $TAUD_THL_CTX --tauh_thl_ctx $TAUH_THL_CTX --ujump_thl_ctx $UJUMP_THL_CTX --beta_thl_ctx $BETA_THL_CTX --delta_thl_ctx $DELTA_THL_CTX --weight_a_thl_ctx $WEIGHTA_THL_CTX --weight_c_thl_ctx $WEIGHTC_THL_CTX --pot_strength_thl_ctx $POT_STRENGTH_THL_CTX --wmax_thl_ctx $WMAX_THL_CTX --wmin_thl_ctx $WMIN_THL_CTX --wee_ctx_thl $WEE_CTX_THL --sparseness_ctx_thl $SPARSENESS_CTX_THL --eta_ctx_thl $ETA_CTX_THL --kappa_ctx_thl $KAPPA_CTX_THL --tauf_ctx_thl $TAUF_CTX_THL --taud_ctx_thl $TAUD_CTX_THL --tauh_ctx_thl $TAUH_CTX_THL --ujump_ctx_thl $UJUMP_CTX_THL --beta_ctx_thl $BETA_CTX_THL --delta_ctx_thl $DELTA_CTX_THL --weight_a_ctx_thl $WEIGHTA_CTX_THL --weight_c_ctx_thl $WEIGHTC_CTX_THL --pot_strength_ctx_thl $POT_STRENGTH_CTX_THL --wmax_ctx_thl $WMAX_CTX_THL --wmin_ctx_thl $WMIN_CTX_THL --wee_thl_hpc $WEE_THL_HPC --sparseness_thl_hpc $SPARSENESS_THL_HPC --eta_thl_hpc $ETA_THL_HPC --kappa_thl_hpc $KAPPA_THL_HPC --tauf_thl_hpc $TAUF_THL_HPC --taud_thl_hpc $TAUD_THL_HPC --tauh_thl_hpc $TAUH_THL_HPC --ujump_thl_hpc $UJUMP_THL_HPC --beta_thl_hpc $BETA_THL_HPC --delta_thl_hpc $DELTA_THL_HPC --weight_a_thl_hpc $WEIGHTA_THL_HPC --weight_c_thl_hpc $WEIGHTC_THL_HPC --pot_strength_thl_hpc $POT_STRENGTH_THL_HPC --wmax_thl_hpc $WMAX_THL_HPC --wmin_thl_hpc $WMIN_THL_HPC --wee_hpc_thl $WEE_HPC_THL --sparseness_hpc_thl $SPARSENESS_HPC_THL --eta_hpc_thl $ETA_HPC_THL --kappa_hpc_thl $KAPPA_HPC_THL --tauf_hpc_thl $TAUF_HPC_THL --taud_hpc_thl $TAUD_HPC_THL --tauh_hpc_thl $TAUH_HPC_THL --ujump_hpc_thl $UJUMP_HPC_THL --beta_hpc_thl $BETA_HPC_THL --delta_hpc_thl $DELTA_HPC_THL --weight_a_hpc_thl $WEIGHTA_HPC_THL --weight_c_hpc_thl $WEIGHTC_HPC_THL --pot_strength_hpc_thl $POT_STRENGTH_HPC_THL --wmax_hpc_thl $WMAX_HPC_THL --wmin_hpc_thl $WMIN_HPC_THL --wee_ctx_hpc $WEE_CTX_HPC --sparseness_ctx_hpc $SPARSENESS_CTX_HPC --eta_ctx_hpc $ETA_CTX_HPC --kappa_ctx_hpc $KAPPA_CTX_HPC --tauf_ctx_hpc $TAUF_CTX_HPC --taud_ctx_hpc $TAUD_CTX_HPC --tauh_ctx_hpc $TAUH_CTX_HPC --ujump_ctx_hpc $UJUMP_CTX_HPC --beta_ctx_hpc $BETA_CTX_HPC --delta_ctx_hpc $DELTA_CTX_HPC --weight_a_ctx_hpc $WEIGHTA_CTX_HPC --weight_c_ctx_hpc $WEIGHTC_CTX_HPC --pot_strength_ctx_hpc $POT_STRENGTH_CTX_HPC --wmax_ctx_hpc $WMAX_CTX_HPC --wmin_ctx_hpc $WMIN_CTX_HPC --wee_hpc_ctx $WEE_HPC_CTX --sparseness_hpc_ctx $SPARSENESS_HPC_CTX --eta_hpc_ctx $ETA_HPC_CTX --kappa_hpc_ctx $KAPPA_HPC_CTX --tauf_hpc_ctx $TAUF_HPC_CTX --taud_hpc_ctx $TAUD_HPC_CTX --tauh_hpc_ctx $TAUH_HPC_CTX --ujump_hpc_ctx $UJUMP_HPC_CTX --beta_hpc_ctx $BETA_HPC_CTX --delta_hpc_ctx $DELTA_HPC_CTX --weight_a_hpc_ctx $WEIGHTA_HPC_CTX --weight_c_hpc_ctx $WEIGHTC_HPC_CTX --pot_strength_hpc_ctx $POT_STRENGTH_HPC_CTX --wmax_hpc_ctx $WMAX_HPC_CTX --wmin_hpc_ctx $WMIN_HPC_CTX --tauc_ee_thl $TAUC_EE_THL --tauc_ee_stim_thl $TAUC_EE_STIM_THL --tauc_ee_ctx $TAUC_EE_CTX --tauc_ee_stim_ctx $TAUC_EE_STIM_CTX --tauc_ee_hpc $TAUC_EE_HPC --tauc_ee_stim_hpc $TAUC_EE_STIM_HPC --tauc_thl_ctx $TAUC_THL_CTX --tauc_ctx_thl $TAUC_CTX_THL --tauc_thl_hpc $TAUC_THL_HPC --tauc_hpc_thl $TAUC_HPC_THL --tauc_ctx_hpc $TAUC_CTX_HPC --tauc_hpc_ctx $TAUC_HPC_CTX --on $ON_LEARN --off $OFF_LEARN --scale $SCALE_LEARN --bgrate $BGRATE --bgrate_rep $BGRATE_REP --preferred $PREFERRED --stimfile $STIMFILE --rep_spike_mon --rep_seed ${REP_SEED_LEARN[$TRIAL_ID]} --size_rep $SIZE_REP --w_rep_thl $W_REP_THL --sparseness_rep_thl $SPARSENESS_REP_THL --w_rep_ctx $W_REP_CTX --sparseness_rep_ctx $SPARSENESS_REP_CTX --w_rep_hpc $W_REP_HPC --sparseness_rep_hpc $SPARSENESS_REP_HPC --bg_spike_mon --bg_thl_seed ${BG_THL_SEED_LEARN[$TRIAL_ID]} --bg_ctx_seed ${BG_CTX_SEED_LEARN[$TRIAL_ID]} --bg_hpc_seed ${BG_HPC_SEED_LEARN[$TRIAL_ID]} --bgrate_thl $BGRATE_THL --sparseness_bg_thl $SPARSENESS_BG_THL --w_bg_thl $W_BG_THL --bgrate_ctx $BGRATE_CTX --sparseness_bg_ctx $SPARSENESS_BG_CTX --w_bg_ctx $W_BG_CTX --bgrate_hpc $BGRATE_HPC --sparseness_bg_hpc $SPARSENESS_BG_HPC --w_bg_hpc $W_BG_HPC --wext_ei_thl $WEXT_EI_THL --wext_ei_ctx $WEXT_EI_CTX --wext_ei_hpc $WEXT_EI_HPC --wei_thl_ctx $WEI_THL_CTX --wei_ctx_thl $WEI_CTX_THL --wei_thl_hpc $WEI_THL_HPC --wei_hpc_thl $WEI_HPC_THL --wei_ctx_hpc $WEI_CTX_HPC --wei_hpc_ctx $WEI_HPC_CTX --w_bg_ei_thl $W_BG_EI_THL --w_bg_ei_ctx $W_BG_EI_CTX --w_bg_ei_hpc $W_BG_EI_HPC
